(this["webpackJsonptelar-social-engine"]=this["webpackJsonptelar-social-engine"]||[]).push([[30],{1175:function(e,t,a){"use strict";a.r(t),a.d(t,"PhotoMasterComponent",(function(){return ge}));var s=a(8),r=a(828),n=a(1153),l=a(854),o=a(1160),i=a(1154),c=a(504),u=a(1136),m=a(470),d=a(310),h=a(468),p=a(295),b=a.n(p),g=a(176),E=a(527),I=a.n(E),A=a(1122),f=a.n(A),D=a(1123),O=a.n(D),w=a(535),v=a(593),C=a(501),P=a(260),j=a.n(P),M=a(639),x=a(0),S=a.n(x),y=a(1059),N=a.n(y),k=a(589),R=a.n(k);class U extends x.Component{constructor(e){super(e),this.handleClosePictureDialog=()=>{this.setState({pictureDialogOpen:!1})},this.handleOpenPictureDialog=()=>{this.setState({pictureDialogOpen:!0})},this.renderGrid=e=>{const t=this.props,a=t.images,s=t.classes,r=t.onDelete,n=t.isOwner,l=y.transitions.scaleDown;return S.a.createElement(N.a,{monitorImagesLoaded:!0,columnWidth:300,duration:600,gutterWidth:15,gutterHeight:15,easing:y.easings.cubicOut,appearDelay:60,appear:l.appear,appeared:l.appeared,enter:l.enter,entered:l.entered,leaved:l.leaved},a.map(((t,a)=>S.a.createElement("figure",{key:t.src,className:"image-stack"},S.a.createElement(M.a,{src:t.url,width:"300px",height:"300px",onClick:()=>{e(a)}}),n&&S.a.createElement("div",{className:s.deleteIcon},void 0!==t.url?S.a.createElement(c.a,{className:s.icon,onClick:()=>r(t)},S.a.createElement(j.a,{style:{color:"white"}})):S.a.createElement(C.a,{className:s.progress,size:30,style:{color:"white",marginLeft:10}})),S.a.createElement("figcaption",null,t.caption)))))},this.state={pictureDialogOpen:!1},this.handleClosePictureDialog=this.handleClosePictureDialog.bind(this),this.handleOpenPictureDialog=this.handleOpenPictureDialog.bind(this),this.renderGrid=this.renderGrid.bind(this)}render(){const e=this.props,t=e.images,a=e.classes;return S.a.createElement(R.a,{images:t,renderImageFunc:e=>S.a.createElement("div",{className:a.root},this.renderGrid(e))})}}var q=b()((()=>({gridList:{overflowY:"hidden"},deleteIcon:{position:"absolute",top:0,right:0,backgroundColor:"#b3b3b347",borderRadius:"50%"}})))(U),T=a(97),L=a(536),G=a(1121),J=a(126),H=a(531),W=a(59),z=a(71),F=a(18),B=a(25),Y=a(44),Z=a(5),K=a(43),Q=a(32),V=a(519),X=a(17),$=a(183),_=a(138);const ee=e=>({deleteImage:(t,a)=>e(Y.j(t,B.a.data.imageFolderPath,a)),setHomeTitle:t=>e(Z.q(t||"")),showTopLoading:()=>e(Z.w()),hideTopLoading:()=>e(Z.j())}),te=()=>{const e=F.a.selectCurrentUser(),t=$.a.selectMoreImages(),a=V.a.selectRequest(),s=z.a.selectSearchPosts();return(r,n)=>{const l=e(r).toJS(),o=Object(_.b)(l.userId,"currentUser.userId"),i=K.a.createServerRequestId(Q.a.SearchPosts,o),c=a(r,{requestId:i}),u=Object(_.b)(n.currentAlbum.id,"ownProps.currentAlbum.id"),m=t(r,{albumId:u}),d=s(r);return{hasMorePhotos:m,currentUser:l,searchRequestStatus:c?c.status:X.a.NoAction,posts:d,requestId:i}}};class ae extends x.Component{constructor(e){super(e),this.loader=()=>{const e=this.props.loadPhotos;e&&e(0)},this.handleDelete=e=>{const t=this.props,a=t.deleteImage,s=t.onDelete;a&&a(e.objectId,e.fileName),s&&s(e.objectId)},this.renderGallery=()=>{const e=this.props,t=e.images,a=e.currentUser,s=e.currentAlbum,r=this.state.width;return S.a.createElement(G.a,{bounds:!0,onResize:e=>this.setState({width:e.bounds?e.bounds.width:0})},(({measureRef:e})=>{if(r<1)return S.a.createElement("div",{ref:e});let n=1;return r>=480&&(n=2),r>=1024&&(n=3),r>=1824&&(n=4),S.a.createElement("div",{ref:e},S.a.createElement(q,{isOwner:!(!s||!a)&&s.ownerUserId===a.userId,images:t,cols:n,onDelete:this.handleDelete}))}))},this.state={lightboxIsOpen:!1,currentImage:0,width:-1}}render(){const e=this.props,t=e.images,a=e.hasMorePhotos;return S.a.createElement(L.a,{dataLength:t?t.length:0,next:this.loader,hasMore:a||!1,endMessage:"",loader:S.a.createElement(H.a,{key:"stream-load-more-progress"})},this.renderGallery())}}const se=Object(T.c)("translations")(ae);var re,ne=Object(J.withRouter)((re=b()((e=>({root:{display:"flex",flexWrap:"wrap",justifyContent:"space-around",overflow:"hidden",backgroundColor:e.palette.background.paper},gridList:{width:500,height:450,transform:"translateZ(0)"},titleBar:{background:"linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 70%, rgba(0,0,0,0) 100%)"},icon:{color:"white"}})))(se),Object(W.connect)(te,ee)(re))),le=a(4),oe=a(204),ie=a(114),ce=a.n(ie),ue=a(179),me=a(37),de=a(121);const he=(e,t)=>{const a=t.match.params,s=a.userId,r=a.albumId;return{updateAlbum:(t,a)=>e(me.m(t,a)),loadImages:()=>e(Y.l(s,r)),loadAlbum:()=>e(me.i(s,r)),uploadImage:(t,a)=>e(Y.t(t,a)),deleteAlbum:t=>e(me.h(t)),setHomeTitle:t=>e(Z.q(t||"")),showTopLoading:()=>e(Z.w()),hideTopLoading:()=>e(Z.j()),openAlbum:()=>e(Z.n(ue.a.Album)),closeAlbum:()=>e(Z.c(ue.a.Album))}},pe=()=>{const e=F.a.selectCurrentUser(),t=$.a.selectMoreImages(),a=V.a.selectRequest(),s=$.a.selectAlbumImages(),r=z.a.selectPost(),n=de.a.selectDialogState(),l=de.a.selectProgress();return(o,i)=>{const c=i.match.params.albumId,u=e(o).toJS(),m=n(o,{type:ue.a.Album}),d=l(o),h=K.a.createServerRequestId(Q.a.StreamGetPosts,Object(_.b)(u.userId,"currentUser.userId")),p=a(o,{requestId:h}),b=t(o,c),g=s(o,{albumId:c}).toJS(),E=r(o,{postId:c}).toJS(),I=E.ownerUserId===u.userId;return{hasMoreImages:b,currentUser:u,streamRequestStatus:p?p.status:X.a.NoAction,images:g,requestId:h,currentAlbum:E,progress:d,albumDialogOpen:m,isOwner:I}}};var be=a(29);class ge extends x.Component{constructor(e){super(e),this.selectedPhotos=[],this.handleCloseMenu=()=>{this.setState({anchorElMenu:null})},this.handleOpenMenu=e=>{this.setState({anchorElMenu:e.currentTarget})},this.closeAlbumDialog=()=>{const e=this.props.closeAlbum;e&&e()},this.openAlbumDialog=()=>{const e=this.props.openAlbum;e&&e()},this.onUploadAlbumChange=e=>{const t=this.props.uploadImage;if(t){const a=e.currentTarget.files,s=[];for(let e=0;e<a.length;e++){const r=a[e],n=w.a.getExtension(r.name),l="".concat(ce()(),".").concat(n);s.push({file:URL.createObjectURL(r),fileName:l}),t(r,l)}this.selectedPhotos=s,this.openAlbumDialog(),e.currentTarget.value=null}},this.handleDeleteImage=e=>{const t=this.props,a=t.updateAlbum,r=t.currentAlbum,n=t.images;if(r&&r.album&&r.album.photos&&a&&n&&n.length>0){const t=[];n.slice(0,4).forEach((a=>{a.id!==e&&t.push({url:a.url,fileId:a.id,fileName:a.fileName})})),r.album.photos=t.map((e=>e.url)),t.length>0?(r.image=t[0].url,r.album.cover=t[0].url,r.album.coverId=t[0].fileId):(r.image="",r.album.cover="",r.album.coverId=""),a(Object(le.fromJS)(Object(s.a)({},r)),(()=>{be.a.info("Album Deleted!")}))}},this.handleDeleteAlbum=()=>{const e=this.props,t=e.deleteAlbum,a=e.currentAlbum;t&&a&&a.id&&(t(a.id),this.setState({anchorElMenu:null}))},this.state={anchorElMenu:null},this.loadData=this.loadData.bind(this),this.handleCloseMenu=this.handleCloseMenu.bind(this),this.handleOpenMenu=this.handleOpenMenu.bind(this),this.handleDeleteAlbum=this.handleDeleteAlbum.bind(this),this.handleDeleteImage=this.handleDeleteImage.bind(this)}loadData(){const e=this.props,t=e.loadImages,a=e.loadAlbum;t&&a&&(a(),t())}componentDidMount(){const e=this.props,t=e.setHomeTitle,a=e.t;t&&a&&t(a("header.home")),this.loadData()}render(){const e=this.props,t=e.images,a=e.t,s=e.classes,p=e.currentAlbum,b=e.albumDialogOpen,E=e.isOwner,A=e.progress,D=this.state.anchorElMenu,w=p&&p.album?p.album:{title:""},C=void 0!==b&&b;if(!a)return S.a.createElement("div",null);const P=S.a.createElement("div",null,S.a.createElement(c.a,{"aria-owns":D?"circle-menu":"","aria-haspopup":"true",onClick:this.handleOpenMenu},S.a.createElement(I.a,null)),S.a.createElement(h.a,{id:"current-user-menu-root",anchorEl:D,open:Boolean(D),onClose:this.handleCloseMenu,PaperProps:{style:{maxHeight:900,boxShadow:"0 1px 4px 0 rgba(0,0,0,0.14)"}}},S.a.createElement(m.a,{role:"menu"},S.a.createElement(u.a,{onClick:this.handleDeleteAlbum}," ",a("album.deleteAlbum")," ")))),j=S.a.createElement(l.a,null,S.a.createElement("input",{accept:"image/*",className:s.input,id:"album-button-file",multiple:!0,onChange:this.onUploadAlbumChange,type:"file"}),S.a.createElement("div",{className:s.header},S.a.createElement("label",{htmlFor:"album-button-file"},S.a.createElement(r.a,{component:"span",color:"primary"},S.a.createElement(f.a,null),a("album.addPhotos"))))),M=S.a.createElement("div",null,S.a.createElement(n.a,{className:s.card},S.a.createElement(i.a,{avatar:S.a.createElement(oe.a,{fileName:p&&p.image?p.image:"",fullName:w.title}),action:E&&P,title:w.title,subheader:p&&p.body?p.body:""}),E&&j,S.a.createElement(o.a,null,S.a.createElement(ne,{loadPhotos:this.loadData,onDelete:this.handleDeleteImage,images:t,currentAlbum:Object(_.a)(p,{})}))),C?S.a.createElement(v.a,{currentAlbum:p,open:C,progress:Object(_.a)(A,{}),photos:this.selectedPhotos,onClose:this.closeAlbumDialog}):"");return p&&Object.keys(p).length>0?M:S.a.createElement(d.a,{className:s.noAlbumRoot},S.a.createElement(O.a,{className:s.noAlbumIcon}),S.a.createElement(g.a,{variant:"body1",className:s.noAlbumText},a("album.noExistAlbum")))}}const Ee=Object(T.c)("translations")(ge);t.default=Object(J.withRouter)((e=>Object(W.connect)(pe,he)(e))(b()((e=>({root:{},gridCell:{[e.breakpoints.down("sm")]:{maxWidth:"100% !important",width:"100%"}},noAlbumRoot:{maxWidth:500,textAlign:"center",margin:"0 auto",minHeight:150},noAlbumIcon:{color:"#afafaf",fontSize:74},noAlbumText:{}})))(Ee)))},531:function(e,t,a){"use strict";var s=a(616),r=a(501),n=a(0),l=a.n(n);class o extends n.Component{render(){const e=this.props.theme;return l.a.createElement("div",{key:"load-more-progress",className:"g-load-more"},l.a.createElement(r.a,{size:30,thickness:5,style:{color:e.palette.primary.light}}))}}t.a=Object(s.a)(o)}}]);